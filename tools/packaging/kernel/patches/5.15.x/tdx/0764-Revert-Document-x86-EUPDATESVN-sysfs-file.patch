From cd986756da954cda793f27097cdf05552194ed0e Mon Sep 17 00:00:00 2001
From: Cathy Zhang <cathy.zhang@intel.com>
Date: Fri, 17 Dec 2021 11:09:32 +0800
Subject: [PATCH 0764/1418] Revert "Document/x86: EUPDATESVN sysfs file"

This reverts commit 9d0c861500fd7f83d28d4e434a445f55430a8dda.
---
 .../ABI/testing/sysfs-devices-system-cpu      | 15 -------
 Documentation/x86/sgx.rst                     | 42 -------------------
 2 files changed, 57 deletions(-)

diff --git a/Documentation/ABI/testing/sysfs-devices-system-cpu b/Documentation/ABI/testing/sysfs-devices-system-cpu
index 9cda410e8e86..b46ef147616a 100644
--- a/Documentation/ABI/testing/sysfs-devices-system-cpu
+++ b/Documentation/ABI/testing/sysfs-devices-system-cpu
@@ -650,7 +650,6 @@ Description:	SPURR ticks for cpuX when it was idle.
 		This sysfs interface exposes the number of SPURR ticks
 		for cpuX when it was idle.
 
-<<<<<<< HEAD
 What: 		/sys/devices/system/cpu/cpuX/mte_tcf_preferred
 Date:		July 2021
 Contact:	Linux ARM Kernel Mailing list <linux-arm-kernel@lists.infradead.org>
@@ -667,17 +666,3 @@ Description:	Preferred MTE tag checking mode
 		================  ==============================================
 
 		See also: Documentation/arm64/memory-tagging-extension.rst
-
-What: 		/sys/devices/system/cpu/microcode/svnupdate
-Date:		Aug 2021
-Contact:	linux-sgx@vger.kernel.org
-Description:	Applying SGX Runtime Microcode Updates to Enclaves
-
-		Whenever a microcode update affects SGX, ENCLS[EUPDATESVN]
-		should be taken to update the attestation metric (called
-		CPUSVN) and generate new cryptographic assets without a
-		reboot. EUPDATESVN success requires that all SGX memory to
-		be marked as "unused" and its contents destroyed.
-
-		This sysfs interface is only exposed to userspace on host,
-		to trigger enclave destruction and the EUPDATESVN operation.
diff --git a/Documentation/x86/sgx.rst b/Documentation/x86/sgx.rst
index c895be67e54f..a608f667fb95 100644
--- a/Documentation/x86/sgx.rst
+++ b/Documentation/x86/sgx.rst
@@ -285,45 +285,3 @@ to expected failures and handle them as follows:
    first call.  It indicates a bug in the kernel or the userspace client
    if any of the second round of ``SGX_IOC_VEPC_REMOVE_ALL`` calls has
    a return code other than 0.
-
-Applying Runtime Microcode Updates to Enclaves
-==============================================
-
-SGX enclaves have an attestation mechanism. An enclave might, for
-instance, need to attest to its state before it is given a special
-decryption key. Since SGX must trust the CPU microcode, attestation
-incorporates the microcode versions of all processors on the system
-and is affected by microcode updates. This enables deployment
-decisions based on the microcode version. For example, an enclave
-might be denied a decryption key if it runs on a system that has
-old microcode without a specific mitigation.
-
-Unfortunately, this attestation metric (called CPUSVN) is only a
-snapshot. When the kernel first uses SGX (successfully executes any
-ENCLS instruction), SGX inspects all CPUs in the system and incorporates
-a record of their microcode versions into CPUSVN. CPUSVN is only
-automatically updated at reboot. This means that, although the
-microcode has been updated, enclaves can never attest to this fact.
-Enclaves are stuck attesting to the old version until a reboot.
-
-The SGX architecture has an alternative to these reboots: the
-ENCLS[EUPDATESVN] instruction. It allows another snapshot to be
-taken to update CPUSVN after a runtime microcode update without a
-reboot.
-
-Whenever a microcode update affects SGX, the SGX attestation
-architecture assumes that all running enclaves and cryptographic
-assets (like internal SGX encryption keys) have been compromised.
-To mitigate the impact of this presumed compromise, EUPDATESVN
-success requires that all SGX memory to be marked as "unused" and
-its contents destroyed. This requirement ensures that no compromised
-enclaves can survive the EUPDATESVN procedure and provides an
-opportunity to generate new cryptographic assets.
-
-EUPDATESVN was designed to be separate from the microcode update
-to provide flexibility to administractors. They can immediately
-update the microcode and then schedule enclave destruction and
-EUPDATESVN for a lter more convenient time.
-
-Any write to the sysfs file: **/sys/devices/system/cpu/microcode/svnupdate**
-triggers enclave destruction and the EUPDATESVN operation.
-- 
2.31.1

