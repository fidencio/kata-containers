From 3b72896be0c25247f443964691da917dfb22157a Mon Sep 17 00:00:00 2001
From: Dave Jiang <dave.jiang@intel.com>
Date: Wed, 23 Mar 2022 16:30:01 -0700
Subject: [PATCH 1233/1418] vfio: mdev: idxd: fix vidxd_resume_wq_state() unint
 var

Signed-off-by: Dave Jiang <dave.jiang@intel.com>
---
 drivers/vfio/mdev/idxd/mdev.c | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)

diff --git a/drivers/vfio/mdev/idxd/mdev.c b/drivers/vfio/mdev/idxd/mdev.c
index 380925905809..67f2d5bf9959 100644
--- a/drivers/vfio/mdev/idxd/mdev.c
+++ b/drivers/vfio/mdev/idxd/mdev.c
@@ -434,8 +434,6 @@ static int vidxd_resume_wq_state(struct vdcm_idxd *vidxd)
 				}
 
 				if (wq_pasid >= 0) {
-					u32 status;
-
 					wqcfg->bits[WQCFG_PASID_IDX] &=
 								~GENMASK(29, 8);
 					wqcfg->priv = priv;
@@ -449,8 +447,8 @@ static int vidxd_resume_wq_state(struct vdcm_idxd *vidxd)
 					idxd_wq_setup_priv(wq, priv);
 					spin_unlock_irqrestore(&idxd->dev_lock,
 									flags);
-					idxd_wq_enable(wq, &rc);
-					if (status) {
+					rc = idxd_wq_enable(wq, NULL);
+					if (rc) {
 						dev_err(dev, "resume wq failed\n");
 						break;;
 					}
@@ -462,7 +460,7 @@ static int vidxd_resume_wq_state(struct vdcm_idxd *vidxd)
 				spin_lock_irqsave(&idxd->dev_lock, flags);
 				idxd_wq_setup_pasid(wq, 0);
 				spin_unlock_irqrestore(&idxd->dev_lock, flags);
-				idxd_wq_enable(wq, &rc);
+				rc = idxd_wq_enable(wq, NULL);
 				if (rc) {
 					dev_err(dev, "resume wq %d failed\n",
 							wq->id);
-- 
2.31.1

